@using WMS.Common.Contract
@using WMS.Account.Contract

@model UserClassInfo
@{
    Layout = "~/Views/Shared/_Layout.Edit.cshtml";
}
@section PageSpecificStyleSheetIncludes{
<link rel="stylesheet" href="/assets/css/bootstrap-editable.css" />
    <style type="text/css">
        .row {
            margin-left:0px;
        }
        body{ background-color:#fff;}
        .control-label {
        text-align:right;
        }
    </style>
}
@section PageSpecificJavascriptIncludes{
<script src="/assets/js/x-editable/bootstrap-editable.min.js"></script>
<script src="/assets/js/x-editable/ace-editable.min.js"></script>
<script src="/assets/js/jquery.maskedinput.min.js"></script>

<script type="text/javascript">
    jQuery(function ($) {
        var postUrl = '/Sys/User/EidtAttr';
        var tokenId = '@Model.UserId';
        //editables on first profile page
        $.fn.editable.defaults.mode = 'inline';
        $.fn.editableform.loading = "<div class='editableform-loading'><i class='light-blue icon-2x icon-spinner icon-spin'></i></div>";
        $.fn.editableform.buttons = '<button type="submit" class="btn btn-info editable-submit"><i class="icon-ok icon-white"></i></button>' +
                                    '<button type="button" class="btn editable-cancel"><i class="icon-remove"></i></button>';

        //editables
        $('#username').editable({
            url: postUrl,
            pk: tokenId,
            type: 'text',
            name: 'username',
            success: function (response) {
                alert(response);
            }
        });
        $('#nickname').editable({
            url: postUrl,
            pk: tokenId,
            type: 'text',
            name: 'nickname',
            success: function (response) {
                alert(response);
            }
        });
        $('#telephone').editable({
            url: postUrl,
            pk: tokenId,
            type: 'text',
            name: 'telephone',
            success: function (response) {
                alert(response);
            }
        });


        //var r= "1\n2\n3\n";
        ////将字母\n替换成分号
        //alert(r.replace(/\n/g, ";"));

        //结果：1;2;3; replace 的第一个参数可以是正则表达式，/g标识全文匹配。

        var epList = '@ViewData["eList"] ';
        epList = epList.replace(/&quot;/g, '"');
        var epArr = eval('(' + epList + ')');
        var enterpriseArr = [];
        var dptArr= [];
        for (var i = 0; i < epArr.length; i++)
        {
            enterpriseArr.push({ value: epArr[i].eId, text: epArr[i].eName });
            dptArr[epArr[i].eId]=[];
            for(var j=0;j<epArr[i].eDpt.length;j++)
            {
                dptArr[epArr[i].eId].push({ value: epArr[i].eDpt[j].DptId, text: epArr[i].eDpt[j].DptName });
            }
        }

        var currentValue = '@Model.EnterpriseId';
        $('#enterpriseid').editable({
            url: postUrl,
            pk: tokenId,
            type: 'select',
            name: 'enterpriseid',
            value: '@Model.EnterpriseId',
            source: enterpriseArr,
            success: function (response,newValue) {
                alert(newValue);

                if(currentValue == newValue) return;
                currentValue = newValue;
						
                var new_source = (!newValue || newValue == "") ? [] : dptArr[newValue];
                var city = $('#departmentid').removeAttr('id').get(0);
                $(city).clone().attr('id', 'city').text('请选择部门').editable({
                    url: postUrl,
                    pk: tokenId,
                    type: 'select',
                    value : null,
                    source: new_source
                }).insertAfter(city);//insert it after previous instance
                $(city).remove();//remove previous instance
            }
        });

        $('#departmentid').editable({
            url: postUrl,
            pk: tokenId,
            type: 'select',
            name: 'departmentid',
            value: '@Model.DepartmentId',
            source: dptArr[currentValue],
            success: function (response) {
                alert(response);
            }
        });

        $('#signup').editable({
            type: 'date',
            format: 'yyyy-mm-dd',
            viewformat: 'dd/mm/yyyy',
            datepicker: {
                weekStart: 1
            }
        });

        $('#age').editable({
            type: 'spinner',
            name: 'age',
            spinner: {
                min: 16, max: 99, step: 1
            }
        });

        //var $range = document.createElement("INPUT");
        //$range.type = 'range';
        $('#login').editable({
            type: 'slider',//$range.type == 'range' ? 'range' : 'slider',
            name: 'login',
            slider: {
                min: 1, max: 50, width: 100
            },
            success: function (response, newValue) {
                if (parseInt(newValue) == 1)
                    $(this).html(newValue + " hour ago");
                else $(this).html(newValue + " hours ago");
            }
        });

        $('#about').editable({
            mode: 'inline',
            type: 'wysiwyg',
            name: 'about',
            wysiwyg: {
                //css : {'max-width':'300px'}
            },
            success: function (response, newValue) {
            }
        });

        // *** editable avatar *** //
        try {
            if (/msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase())) Image.prototype.appendChild = function (el) { }
            var last_gritter
            $('#avatar').editable({
                type: 'image',
                name: 'avatar',
                value: null,
                image: {
                    btn_choose: 'Change Avatar',
                    droppable: true,
                    name: 'avatar',//put the field name here as well, will be used inside the custom plugin
                    max_size: 110000,//~100Kb
                    on_error: function (code) {//on_error function will be called when the selected file has a problem
                        if (last_gritter) $.gritter.remove(last_gritter);
                        if (code == 1) {//file format error
                            last_gritter = $.gritter.add({
                                title: '请上传图片文件!',
                                text: '请选择 jpg|gif|png 格式!',
                                class_name: 'gritter-error gritter-center'
                            });
                        } else if (code == 2) {//file size rror
                            last_gritter = $.gritter.add({
                                title: '上传文件过大!',
                                text: '上传图片文件不能超过 100Kb!',
                                class_name: 'gritter-error gritter-center'
                            });
                        }
                        else {//other error
                        }
                    },
                    on_success: function () {
                        $.gritter.removeAll();
                    }
                },
                url: function (params) {
                    var deferred = new $.Deferred
                    var value = $('#avatar').next().find('input[type=hidden]:eq(0)').val();
                    if (!value || value.length == 0) {
                        deferred.resolve();
                        return deferred.promise();
                    }
                    setTimeout(function () {
                        if ("FileReader" in window) {
                            //for browsers that have a thumbnail of selected image
                            var thumb = $('#avatar').next().find('img').data('thumb');
                            if (thumb) $('#avatar').get(0).src = thumb;
                        }
                        deferred.resolve({ 'status': 'OK' });
                        if (last_gritter) $.gritter.remove(last_gritter);
                        last_gritter = $.gritter.add({
                            title: 'Avatar Updated!',
                            text: 'Uploading to server can be easily implemented. A working example is included with the template.',
                            class_name: 'gritter-info gritter-center'
                        });
                    }, parseInt(Math.random() * 800 + 800))
                    return deferred.promise();
                },
                success: function (response, newValue) {
                }
            })
        } catch (e) { }
    });
    $(document).ready(function () {

    });
</script>

}
@section MainContent{

    <div class="row">
        <div class="col-xs-12 col-sm-9">
            <!-- PAGE CONTENT BEGINS -->
            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">登录账号</div>
                    <div class="profile-info-value">
                        <span style="background-color: rgba(0, 0, 0, 0);">@Model.LoginAccount</span>
                    </div>
                </div>
            </div>

            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">真实姓名</div>
                    <div class="profile-info-value">
                        <span class="editable editable-click editable-unsaved" id="username" style="display: inline; background-color: rgba(0, 0, 0, 0);">@Model.UserName</span>
                    </div>
                </div>
            </div>

            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">昵称</div>
                    <div class="profile-info-value">
                        <span class="editable editable-click editable-unsaved" id="nickname" style="display: inline; background-color: rgba(0, 0, 0, 0);">@Model.NickName</span>
                    </div>
                </div>
            </div>

            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">手机号码</div>
                    <div class="profile-info-value">
                        <span class="editable editable-click editable-unsaved" id="telephone" style="display: inline; background-color: rgba(0, 0, 0, 0);">@Model.Mobile</span>
                    </div>
                </div>
            </div>

            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">所属企业</div>
                    <div class="profile-info-value">
                        <span class="editable editable-click editable-unsaved" id="enterpriseid" style="display: inline; background-color: rgba(0, 0, 0, 0);">@Model.EnterpriseName</span>
                        <span class="editable editable-click" id="departmentid" style="display: inline;">@Model.DepartmentName</span>
                    </div>
                </div>
            </div>
                <div class=" form-horizontal" role="form">
                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right">登录账号:</label>
                        <div class="col-sm-9">
                            @if (Model.UserId == 0)
                        {
                    @Html.TextBoxFor(m => m.LoginAccount, new { @class = "col-xs-10 col-sm-5" })
                    <span class="help-inline">@Html.ValidationMessageFor(m => m.LoginAccount)</span>
                        }
                        else
                        {
                    <b class="col-xs-9 col-sm-5" style="line-height:30px;">@Model.LoginAccount</b>
                        }
                        </div>
                    </div>
                    @if (Model.UserId == 0)
                {
                <div class="form-group">
                    <label class="col-sm-3 control-label no-padding-right" for="form-field-2">登录密码:</label>
                    <div class="col-sm-9">
                        @Html.TextBoxFor(m => m.Password, new { @class = "col-xs-10 col-sm-5",@type="password"})
                        <span class="help-inline">默认密码6个1</span>
                    </div>
                </div>
                }
                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right">真实姓名:</label>
                        <div class="col-sm-9">
                            @Html.TextBoxFor(m => m.UserName, new { @class = "col-xs-10 col-sm-5" })
                            <span class="help-inline">@Html.ValidationMessageFor(m => m.UserName)</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right">昵称:</label>
                        <div class="col-sm-9">
                            @Html.TextBoxFor(m => m.NickName, new { @class = "col-xs-10 col-sm-5" })
                            <span class="help-inline">@Html.ValidationMessageFor(m => m.NickName)</span>
                        </div>
                    </div>

                    http://localhost:57216/assets/ace_demo/profile.html
                    可以参照这个页面的用户信息做修改页面

                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right" for="form-field-4">Relative Sizing</label>

                        <div class="col-sm-9">
                            <input class="input-sm" type="text" id="form-field-4" placeholder=".input-sm" />
                            <div class="space-2"></div>

                            <div class="help-block" id="input-size-slider"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right" for="form-field-5">Grid Sizing</label>

                        <div class="col-sm-9">
                            <div class="clearfix">
                                <input class="col-xs-1" type="text" id="form-field-5" placeholder=".col-xs-1" />
                            </div>

                            <div class="space-2"></div>

                            <div class="help-block" id="input-span-slider"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right">Input with Icon</label>

                        <div class="col-sm-9">
                            <span class="input-icon">
                                <input type="text" id="form-field-icon-1" />
                                <i class="icon-leaf blue"></i>
                            </span>

                            <span class="input-icon input-icon-right">
                                <input type="text" id="form-field-icon-2" />
                                <i class="icon-leaf green"></i>
                            </span>
                        </div>
                    </div>

                    <div class="space-4"></div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right" for="form-field-6">Tooltip and help button</label>

                        <div class="col-sm-9">
                            <input data-rel="tooltip" type="text" id="form-field-6" placeholder="Tooltip on hover" title="Hello Tooltip!" data-placement="bottom" />
                            <span class="help-button" data-rel="popover" data-trigger="hover" data-placement="left" data-content="More details." title="Popover on hover">?</span>
                        </div>
                    </div>

                    <div class="space-4"></div>

                    <div class="form-group">
                        <label class="col-sm-3 control-label no-padding-right" for="form-field-tags">Tag input</label>

                        <div class="col-sm-9">
                            <input type="text" name="tags" id="form-field-tags" value="Tag Input Control" placeholder="Enter tags ..." />
                        </div>
                    </div>

                    <div class="clearfix form-actions">
                        <div class="col-md-offset-3 col-md-9">
                            <button class="btn btn-info" type="button">
                                <i class="icon-ok bigger-110"></i>
                                Submit
                            </button>

                            &nbsp; &nbsp; &nbsp;
                            <button class="btn" type="reset">
                                <i class="icon-undo bigger-110"></i>
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        <div class="col-xs-12 col-sm-3">
            <div>
                <span class="profile-picture">
                    <img id="avatar" class="editable img-responsive editable-click editable-empty" alt="Alex's Avatar" src="/assets/avatars/profile-pic.jpg" />
                </span>
            </div>
        </div>
    </div>
}
